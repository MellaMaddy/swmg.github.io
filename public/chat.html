<script src="/socket.io/socket.io.js"></script>
<script>
const messagesList = document.getElementById("messages");
const userListEl = document.getElementById("user-list");

// Connect immediately; username is handled server-side
const socket = io();

// Update user list
socket.on("user list", users => {
  userListEl.innerHTML = "";
  users.forEach(u => {
    const li = document.createElement("li");
    li.textContent = u;
    li.onclick = () => {
      const msg = prompt("Send private message to " + u);
      if(!msg) return;
      socket.emit("private message", { to: u, message: msg });
    };
    userListEl.appendChild(li);
  });
});

// Receive public messages
socket.on("chat message", msg => {
  const li = document.createElement("li");
  li.className = "message";
  li.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
  messagesList.appendChild(li);
  messagesList.scrollTop = messagesList.scrollHeight;
});

// Receive private messages
socket.on("private message", ({ from, message }) => {
  const li = document.createElement("li");
  li.className = "message private";
  li.innerHTML = `<strong>(Private) ${from}:</strong> ${message}`;
  messagesList.appendChild(li);
  messagesList.scrollTop = messagesList.scrollHeight;
});

// Send public message
document.getElementById("chat-form").onsubmit = e => {
  e.preventDefault();
  const text = document.getElementById("msg").value.trim();
  if(!text) return;
  socket.emit("chat message", { user: "", text }); // server fills username
  document.getElementById("msg").value = "";
};
</script>


